<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#000000" />
  <title>TF-Stream</title>
  <!-- PWA manifest et icônes -->
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" type="image/jpeg" href="https://files.catbox.moe/ixgmht.jpg" />
  <link rel="apple-touch-icon" href="https://files.catbox.moe/ixgmht.jpg" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    body { margin:0; background:#000; color:#fff; font-family:'Roboto',sans-serif; overflow-x:hidden; padding-bottom:60px; }
    .header{padding:20px;text-align:center;position:sticky;top:0;backdrop-filter:blur(10px);background:rgba(0,0,0,0.7);z-index:10;}
    .logo{font-size:28px;font-weight:bold;background:linear-gradient(90deg,#fff,#000);-webkit-background-clip:text;-webkit-text-fill-color:transparent;filter:blur(0.5px);}
    .filter-bar{display:flex;justify-content:center;gap:10px;margin:10px 0;flex-wrap:wrap;}
    .filter-btn{background:#222;color:#fff;border:none;padding:6px 14px;border-radius:30px;cursor:pointer;}
    .filter-btn.active{background:#444;}
    .search-container{display:flex;justify-content:center;padding:10px 20px;}
    .search-box{width:100%;max-width:500px;background:#1c1c1e;border:none;padding:12px 20px;border-radius:15px;color:#fff;font-size:16px;box-shadow:inset 0 0 5px #000;outline:none;}
    .video-list{display:flex;flex-wrap:wrap;gap:15px;padding:20px;justify-content:center;}
    .video-card{position:relative;width:110px;background:#111;border-radius:10px;overflow:hidden;cursor:pointer;transition:transform .2s;}
    .video-card:hover{transform:scale(1.03);}
    .video-card img{width:100%;display:block;}
    .card-overlay{position:absolute;inset:0;background:rgba(0,0,0,0.6);opacity:0;display:flex;align-items:center;justify-content:center;transition:opacity .3s;}
    .video-card:hover .card-overlay{opacity:1;}
    .play-icon{font-size:40px;color:#fff;}
    .info{padding:6px;text-align:center;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
    .nav-bar{position:fixed;bottom:0;width:100%;background:#111;display:flex;justify-content:space-around;padding:10px 0;z-index:20;border-top:1px solid #333;}
    .nav-btn{background:none;border:none;color:#aaa;font-size:14px;text-align:center;flex:1;cursor:pointer;}
    .nav-btn.active{color:#fff;font-weight:bold;}
    #explorerView{padding:20px;max-height:calc(100vh-120px);overflow-y:auto;display:none;background:#000;-webkit-overflow-scrolling:touch;}
    .post-card{background:#111;border-radius:15px;padding:15px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.7);}
    .post-name{font-weight:700;font-size:17px;margin-bottom:8px;color:#fff;}
    .post-text{font-size:15px;color:#ddd;margin-bottom:10px;white-space:pre-wrap;}
    .social-section{margin-top:10px;padding-top:10px;border-top:1px solid #333;display:flex;justify-content:center;gap:15px;}
    .social-section img{width:40px;height:40px;}
    .overlay-fond{position:fixed;inset:0;background:rgba(0,0,0,0.8);backdrop-filter:blur(20px);display:none;justify-content:center;align-items:flex-start;padding:20px;overflow-y:auto;z-index:999;}
    .modal-container{background:#111;border-radius:10px;padding:20px;max-width:700px;width:100%;box-shadow:0 4px 20px rgba(0,0,0,0.8);position:relative;}
    .modal-container button{background:#444;color:#fff;border:none;padding:8px 14px;border-radius:6px;cursor:pointer;}
    .thumbnail{width:100%;max-height:300px;object-fit:cover;border-radius:6px;margin-bottom:12px;}
    .modal-title{font-size:24px;font-weight:700;margin-bottom:8px;}
    .modal-controls{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
    .season-list{position:absolute;top:60px;right:20px;background:#111;border-radius:6px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,0.7);display:none;}
    .season-list button{width:100%;padding:10px;text-align:left;background:#222;color:#fff;border:none;border-bottom:1px solid #333;cursor:pointer;}
    .modal-info{background:#111;border-radius:6px;padding:12px;font-size:14px;color:#ddd;margin-bottom:12px;display:none;}
    .modal-episodes{display:grid;grid-template-columns:1fr;gap:10px;}
    .episode-item{background:rgba(0,0,0,0.6);padding:12px;border-radius:8px;cursor:pointer;transition:transform .2s;}
    .episode-item:hover{transform:scale(1.02);}
    .episode-item.active { background: rgba(200,200,200,0.3); }
    .episode-item.visited { background: rgba(50,50,50,0.4); color: #aaa; font-weight: normal; }
    .ad-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.9);display:none;justify-content:center;align-items:center;z-index:1000;}
    .ad-container{background:#111;padding:20px;border-radius:10px;text-align:center;}
    .ad-container button{background:#444;color:#fff;border:none;padding:10px 20px;border-radius:6px;cursor:pointer;}
/* Splash full-screen */
#splash {
  position: fixed;
  inset: 0;
  background: #000;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  animation: splashPop 1.7s forwards;
}
.splash-logo {
  font-size: 3rem;
  font-weight: bold;
  background: linear-gradient(90deg, #fff, #000);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  filter: blur(0.5px);
  margin: 0;
  animation: logoPop 1.7s ease-out forwards;
}
.splash-version { margin-top: 0.5rem; color: #aaa; font-size: 1rem; animation: logoPop 1.7s ease-out forwards; }
.media-container video, .thumbnail { object-fit: contain; background:#000; }
@keyframes splashPop { 0% { opacity: 1; } 80% { opacity: 1; } 100% { opacity: 0; } }
@keyframes logoPop { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 1; } 80% { transform: scale(1.1); opacity: 1; } 100% { transform: scale(1.1); opacity: 0; } }
.media-container { width: 100%; height: 180px; overflow: hidden; border-radius: 8px; margin-bottom: 10px; }
.media-container img, .media-container video { width: 100%; height: 100%; object-fit: cover; }
  </style>
</head>
<body>
  <!-- Splash Screen full-screen -->
  <div id="splash">
    <h1 class="splash-logo">TF-Stream</h1>
    <p class="splash-version">D'H7 | Tergene</p>
  </div>

  <div id="fondOverlay" class="overlay-fond"></div>

  <script>
    // --- basic variables + small helpers ---
    document.addEventListener('contextmenu', e => e.preventDefault());
    const socialLinks = {
      whatsapp: "https://whatsapp.com/channel/0029VbB3DwvLtOjCUY4RaK39",
      instagram: "https://www.instagram.com/tfstream7?igsh=ZmE2OHB3MjU5NWY3&utm_source=ig_contact_invite",
      facebook: "https://www.facebook.com/profile.php?id=61578064777470",
      youtube: "https://www.youtube.com/@TFStream7",
      gmail: "mailto:tfstream7@gmail"
    };
    const adUrl = "https://www.profitableratecpm.com/avzy4dviv?key=537eddf372aea1f2944a98fcd202d302";
    const fallbackPoster = "https://via.placeholder.com/640x360?text=Pas+d'aper%C3%A7u";
    let allData = [];
    let lastExplorerScroll = 0;

    // Ensure initial history state so browser back works predictably
    if (!history.state) history.replaceState({view:'home'}, '', '');

    // --- load JSON index(s) ---
    fetch('index.json')
      .then(r => r.json())
      .then(files => Promise.all(files.map(f => fetch(f).then(r => r.json()))))
      .then(jsons => {
        jsons.forEach(d => Array.isArray(d) ? allData.push(...d) : allData.push(d));
        displayVideos(allData);
      })
      .catch(err => console.error('Erreur chargement JSON :', err));

    // --- display home grid ---
    function displayVideos(videos) {
      const list = document.getElementById('videoList');
      if (!list) return;
      list.innerHTML = '';
      const catBtn = document.querySelector('.filter-btn.active');
      const cat = (catBtn && catBtn.textContent) ? catBtn.textContent.toLowerCase() : 'tout';

      videos.forEach((v, idx) => {
        const c = (v.Catégorie||v.category||'').toLowerCase();
        if (c === 'poste' || c === 'post') return;
        if (cat !== 'tout' &&
            ((cat === 'film' && c !== 'film') ||
             (cat === 'série' && c !== 'série' && c !== 'serie') ||
             (cat === 'anime' && c !== 'anime' && c !== 'animé'))) return;

        const card = document.createElement('div');
        card.className = 'video-card';
        card.innerHTML = `
          <img src="${v['Url Thumb']||'thumb.jpg'}" alt="${(v.Titre||v.Name||v.Texte||'Sans titre').replace(/"/g,'')}">
          <div class="card-overlay"><span class="play-icon">▶</span></div>
          <div class="info">${v.Titre||v.Name||v.Texte||'Sans titre'}</div>
        `;
        card.onclick = (ev) => {
          ev.stopPropagation();
          showPostModal(v, idx);
        };
        list.appendChild(card);
      });
    }

    // --- filters & search ---
    function filterCategory(_, e){
      document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
      e.target.classList.add('active');
      displayVideos(allData);
    }
    function filterSearch(val){
      displayVideos(allData.filter(i=>
        (i.Titre||i.Name||i.Texte||'').toLowerCase().includes(val.toLowerCase())
      ));
    }

    // --- shuffle helpers used when clicking same nav ---
    function shuffleHomeCards(){
      const list = document.getElementById('videoList');
      if (!list) return;
      const cards = Array.from(list.querySelectorAll('.video-card'));
      if(cards.length<=1) return;
      for(let i=cards.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [cards[i],cards[j]]=[cards[j],cards[i]];
      }
      cards.forEach(c=>list.appendChild(c));
    }

    function shuffleExplorerCards() {
      const ex = document.getElementById('explorerView');
      if (!ex) return;
      const cards = Array.from(ex.querySelectorAll('.post-card'));
      if (!cards.length) return;
      for (let i = cards.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [cards[i], cards[j]] = [cards[j], cards[i]];
      }
      cards.forEach((card) => ex.appendChild(card));
      sessionStorage.setItem('explorer-scroll-pos', String(ex.scrollTop));
    }

    // --- navigation (Accueil / Explorer) with history support ---
    function navigateTo(sec, e){
      const clicked = e && e.target;
      const current = (history.state && history.state.view) ? history.state.view : 'home';

      // if clicking same tab: just shuffle, don't push new history
      if ((sec === 'Accueil' && current === 'home') || (sec === 'Explorer' && current === 'explorer')) {
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        if (clicked) clicked.classList.add('active');
        if (sec === 'Accueil') shuffleHomeCards(); else shuffleExplorerCards();
        return;
      }

      // visual active update
      document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
      if (clicked) clicked.classList.add('active');

      if (sec === 'Accueil') {
        document.getElementById('videoList').style.display='flex';
        document.querySelector('.filter-bar').style.display='flex';
        document.querySelector('.search-container').style.display='flex';
        document.getElementById('explorerView').style.display='none';
        // push state so hardware back works
        history.pushState({view:'home'}, '', '');
        return;
      }

      if (sec === 'Explorer') {
        displayExplorer(false);
        document.getElementById('explorerView').style.display='block';
        document.getElementById('videoList').style.display='none';
        document.querySelector('.filter-bar').style.display='none';
        document.querySelector('.search-container').style.display='flex';
        // store scroll before pushing
        try { sessionStorage.setItem('explorer-scroll-pos', String(document.getElementById('explorerView').scrollTop || 0)); } catch(e){}
        history.pushState({view:'explorer', savedScroll:lastExplorerScroll}, '', '');
        return;
      }
    }

    // --- Explorer rendering (inline play on click / swipe) ---
    function displayExplorer(forceRender=false) {
      const ex = document.getElementById('explorerView');
      if (!ex) return;
      if (ex.dataset.rendered && !forceRender) {
        const saved = sessionStorage.getItem('explorer-scroll-pos');
        if (saved) ex.scrollTop = parseInt(saved, 10) || 0;
        return;
      }
      ex.innerHTML = '';
      ex.dataset.rendered = '1';

      const posts = allData.filter(p => {
        const c = ((p.Catégorie||p.category||'').toLowerCase());
        return c === 'poste' || c === 'post';
      });

      posts.forEach((post, i) => {
        const thumbUrl = post['Url Thumb'] || '';
        const videoUrl = (post.Previously || post['Previously '] || post.video || post.url || '').trim();
        const card = document.createElement('div');
        card.className = 'post-card';
        card.innerHTML = `
          <div class="media-container">
            <img class="thumb" src="${thumbUrl}" alt="Vignette de ${ (post.Name||'').replace(/"/g,'') }">
            ${videoUrl ? `<div class="explore-play-wrap"><button class="explore-play-btn" title="Lire">▶</button></div>` : ''}
          </div>
          <div class="post-name">${post.Name||''}</div>
          <div class="post-text">${post.Description||post.Bio||''}</div>
        `;
        ex.appendChild(card);

        if (videoUrl) {
          const mediaWrap = card.querySelector('.media-container');
          const playBtn = card.querySelector('.explore-play-btn');
          if (playBtn) {
            playBtn.addEventListener('click', ev => {
              ev.stopPropagation();
              mediaWrap.innerHTML = `<video src="${videoUrl}" controls autoplay playsinline style="width:100%;border-radius:8px"></video>`;
            }, { passive: true });
          }

          // swipe -> play
          let startX = 0;
          card.addEventListener('touchstart', e => startX = e.changedTouches[0].clientX, {passive:true});
          card.addEventListener('touchend', e => {
            const endX = e.changedTouches[0].clientX;
            if (Math.abs(endX - startX) > 50) {
              mediaWrap.innerHTML = `<video src="${videoUrl}" controls autoplay playsinline style="width:100%;border-radius:8px"></video>`;
            }
          }, {passive:true});
        }
      });

      displaySocialLinks();
      const saved = sessionStorage.getItem('explorer-scroll-pos');
      if (saved) ex.scrollTop = parseInt(saved, 10) || 0;
    }

    function displaySocialLinks(){
      const c=document.getElementById('explorerView');
      if(!c) return;
      if (c.querySelector('.social-section')) return;
      const s=document.createElement('div'); s.className='social-section';
      s.innerHTML=`
        <a href="${socialLinks.facebook}" target="_blank" rel="noopener"><img src="https://img.icons8.com/?size=100&id=118467&format=png&color=ffffff"/></a>
        <a href="${socialLinks.gmail}" target="_blank" rel="noopener"><img src="https://img.icons8.com/?size=100&id=Y2GfpkgYNp42&format=png&color=ffffff"/></a>
        <a href="${socialLinks.whatsapp}" target="_blank" rel="noopener"><img src="https://img.icons8.com/?size=100&id=16733&format=png&color=ffffff"/></a>
        <a href="${socialLinks.instagram}" target="_blank" rel="noopener"><img src="https://img.icons8.com/?size=100&id=32309&format=png&color=ffffff"/></a>
        <a href="${socialLinks.youtube}" target="_blank" rel="noopener"><img src="https://img.icons8.com/?size=100&id=37326&format=png&color=ffffff"/></a>`;
      c.appendChild(s);
    }

    // --- modal (post) with history support ---
    function showPostModal(post, postIndex){
      const overlay = document.getElementById('fondOverlay');
      overlay.innerHTML = `
        <div class="modal-container">
          <button id="modalBackBtn">← Retour</button>
          <video id="modalThumb" class="thumbnail" muted controls playsinline controlsList="nodownload" preload="metadata"></video>
          <div id="modalTitle" class="modal-title"></div>
          <div class="modal-controls">
            <button id="infoBtn">Voir plus…</button>
            <button id="seasonBtn">Saison 1</button>
          </div>
          <div id="seasonList" class="season-list"></div>
          <div id="modalInfo" class="modal-info"></div>
          <div id="episodeList" class="modal-episodes"></div>
        </div>`;
      overlay.style.display = 'flex';

      // push state so hardware back closes modal
      history.pushState({view:'post', postIndex: postIndex, from: (history.state && history.state.view) ? history.state.view : 'home'}, '', '');

      const thumb      = document.getElementById('modalThumb'),
            titleEl    = document.getElementById('modalTitle'),
            infoBtn    = document.getElementById('infoBtn'),
            seasonBtn  = document.getElementById('seasonBtn'),
            seasonList = document.getElementById('seasonList'),
            infoEl     = document.getElementById('modalInfo'),
            epList     = document.getElementById('episodeList'),
            saisons    = post.Saisons||post.Seasons||post.saisons||post.seasons||[];

      const storageKey = `post-${postIndex}-state`;
      let saved = {};
      try { saved = JSON.parse(localStorage.getItem(storageKey) || '{}'); } catch(e){ saved = {}; }

      let playbackTimes = saved.playbackTimes||{};
      let visited       = saved.visited||{};
      titleEl.textContent = post.Titre||post.Name||post.title||'';

      // poster fallback
      try { thumb.poster = post['Url Thumb'] || fallbackPoster; } catch(e){}
      thumb.onerror = () => { try { thumb.poster = post['Url Thumb'] || fallbackPoster; } catch(e){} };

      let currentSeason=0, selectedEpEl=null;

      function saveState(){
        localStorage.setItem(storageKey, JSON.stringify({
          lastVideoUrl: thumb.src,
          playbackTimes,
          visited
        }));
      }

      function renderInfo(){
        const s = saisons[currentSeason] || {};
        infoEl.innerHTML=`
          <strong>Description:</strong> ${s.description||post.Description||''}<br>
          <strong>Bio:</strong> ${s.bio||post.Bio||''}<br>
          <strong>Info:</strong> ${s.info||post.Info||''}
        `;
        infoEl.style.display='block';
      }

      infoBtn.onclick = ()=> infoEl.style.display = infoEl.style.display==='block' ? 'none' : 'block';

      seasonList.innerHTML='';
      (saisons.length ? saisons : [{episodes: []}]).forEach((s,i)=>{
        const b = document.createElement('button');
        b.textContent = `Saison ${i+1}`;
        b.onclick = ()=> {
          currentSeason = i;
          seasonBtn.textContent = `Saison ${i+1}`;
          renderInfo(); renderEpisodes();
          seasonList.style.display='none';
        };
        seasonList.appendChild(b);
      });
      seasonBtn.onclick = ()=> seasonList.style.display = seasonList.style.display==='block' ? 'none' : 'block';

      function renderEpisodes(){
        epList.innerHTML = '';
        const eps = (saisons[currentSeason] && saisons[currentSeason].episodes) ? saisons[currentSeason].episodes : [];
        eps.forEach((ep,i)=>{
          const d=document.createElement('div');
          d.className='episode-item';
          d.innerHTML=`<strong>Episode ${i+1}</strong><div>${ep.description||''}</div>`;
          if(visited[ep.video]) d.classList.add('visited');

          d.onclick = ()=> {
            try { window.open(adUrl,'_blank'); } catch(e){}
            if(thumb.src) {
              try { playbackTimes[thumb.src]=thumb.currentTime; } catch(e){}
            }

            if(selectedEpEl) selectedEpEl.classList.remove('active');
            d.classList.add('active');
            selectedEpEl = d;

            // set video + poster + restore time
            thumb.src = ep.video;
            try { thumb.poster = post['Url Thumb'] || fallbackPoster; } catch(e){}
            thumb.setAttribute('preload','metadata');
            try { thumb.currentTime = playbackTimes[ep.video]||0; } catch(e){}

            // scroll into view then try play
            try { thumb.scrollIntoView({ behavior: 'smooth', block: 'center', inline: 'nearest' }); } catch(err){}
            setTimeout(()=> { thumb.play().catch(()=>{}); }, 250);

            const onTime = ()=>{
              try {
                if (thumb.currentTime > 2) {
                  d.classList.add('visited');
                  visited[ep.video] = true;
                  thumb.removeEventListener('timeupdate', onTime);
                  saveState();
                }
              } catch(e){}
            };
            thumb.addEventListener('timeupdate', onTime);
            saveState();
          };

          epList.appendChild(d);
        });
      }

      renderInfo();
      renderEpisodes();

      // restore last video (without auto-click)
      if (saved.lastVideoUrl) {
        const eps = (saisons[currentSeason] && saisons[currentSeason].episodes) ? saisons[currentSeason].episodes : [];
        const idx = eps.findIndex(ep => ep && ep.video === saved.lastVideoUrl);
        if (idx > -1) {
          try {
            thumb.src = eps[idx].video;
            thumb.poster = post['Url Thumb'] || fallbackPoster;
            thumb.setAttribute('preload','metadata');
            try { thumb.currentTime = (playbackTimes && playbackTimes[eps[idx].video]) ? playbackTimes[eps[idx].video] : 0; } catch(e){}
          } catch (err) {
            console.warn('Impossible de restaurer la vidéo sauvegardée', err);
          }
        }
      }

      // wire modal back to history.back()
      const backBtn = document.getElementById('modalBackBtn');
      if (backBtn) backBtn.onclick = ()=> history.back();
    }

    function closeModal(){
      // use history.back() to restore previous view (works for hardware back too)
      history.back();
    }

    // --- popstate handler: restore home / explorer / modal depending on state ---
    window.addEventListener('popstate', (e) => {
      const state = e.state || {view:'home'};
      if (!state || state.view === 'home') {
        // show home
        document.getElementById('videoList').style.display='flex';
        document.querySelector('.filter-bar').style.display='flex';
        document.querySelector('.search-container').style.display='flex';
        document.getElementById('explorerView').style.display='none';
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        const navAccueil = document.querySelectorAll('.nav-bar .nav-btn')[0];
        if(navAccueil) navAccueil.classList.add('active');
        // hide modal
        const overlay = document.getElementById('fondOverlay');
        if (overlay) overlay.style.display='none';
      } else if (state.view === 'explorer') {
        // show explorer
        document.getElementById('videoList').style.display='none';
        document.querySelector('.filter-bar').style.display='none';
        document.querySelector('.search-container').style.display='flex';
        document.getElementById('explorerView').style.display='block';
        document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active'));
        const navExplorer = document.querySelectorAll('.nav-bar .nav-btn')[1];
        if(navExplorer) navExplorer.classList.add('active');
        displayExplorer(false);
        // restore scroll
        const saved = (state.savedScroll !== undefined) ? state.savedScroll : sessionStorage.getItem('explorer-scroll-pos');
        if (saved !== undefined && saved !== null) {
          try { document.getElementById('explorerView').scrollTop = parseInt(saved, 10) || 0; } catch (e){}
        }
        const overlay = document.getElementById('fondOverlay');
        if (overlay) overlay.style.display='none';
      } else if (state.view === 'post') {
        // open modal for post
        const idx = state.postIndex;
        const post = allData[idx] || null;
        if (post) {
          showPostModal(post, idx);
        } else {
          // fallback to home
          history.replaceState({view:'home'}, '', '');
          document.getElementById('videoList').style.display='flex';
          const overlay = document.getElementById('fondOverlay');
          if (overlay) overlay.style.display='none';
        }
      }
    });

    // --- service worker registration (unchanged) ---
    window.addEventListener('load', () => {
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('/sw.js', { scope: '/' })
          .then(reg => {
            console.log('SW registered, scope:', reg.scope);
            navigator.serviceWorker.ready.then(regReady => {
              if (regReady.active && regReady.active.postMessage) {
                regReady.active.postMessage({ type: 'LIST_CACHES' });
              }
            });
          })
          .catch(err => console.error('SW reg failed', err));

        navigator.serviceWorker.addEventListener('message', ev => {
          if (ev.data && ev.data.type === 'CACHES_LIST') {
            console.log('SW caches list:', ev.data.payload);
          } else if (ev.data && ev.data.type === 'CACHES_ERROR') {
            console.error('SW caches error:', ev.data.payload);
          } else {
            console.log('SW message:', ev.data);
          }
        });
      } else {
        console.warn('Service Worker not supported');
      }
    });

    // remove splash
    setTimeout(() => {
      const splash = document.getElementById('splash');
      if (splash) splash.remove();
    }, 1700);
  </script>

  <!-- overlay element (modal) -->
  <div id="fondOverlay" class="overlay-fond"></div>

  <!-- header + UI -->
  <div class="header">
    <div class="logo">TF-Stream</div>
    <div class="filter-bar">
      <button class="filter-btn active" onclick="filterCategory('Tout',event)">Tout</button>
      <button class="filter-btn" onclick="filterCategory('Film',event)">Film</button>
      <button class="filter-btn" onclick="filterCategory('Série',event)">Série</button>
      <button class="filter-btn" onclick="filterCategory('Anime',event)">Anime</button>
    </div>
    <div class="search-container">
      <input class="search-box" placeholder="Rechèch..." oninput="filterSearch(this.value)">
    </div>
  </div>

  <div class="video-list" id="videoList"></div>
  <div id="explorerView"></div>

  <div class="nav-bar">
    <button class="nav-btn active" onclick="navigateTo('Accueil',event)">Accueil</button>
    <button class="nav-btn" onclick="navigateTo('Explorer',event)">Explorer</button>
  </div>

  <div id="adOverlay" class="ad-overlay">
    <div class="ad-container">
      <p>Publicité</p>
      <button id="adLinkBtn">En savoir plus</button>
      <button onclick="closeModal()">Fermer</button>
    </div>
  </div>

</body>
</html>
```0
